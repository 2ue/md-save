# Web Clipper 2.0 - 完整重构项目文档

**项目代号**：Clipper V2
**文档版本**：v1.0
**创建日期**：2025-01-25
**状态**：需求分析完成 ✅

---

## 📚 文档导航

本目录包含 Web Clipper 2.0 的完整需求分析、技术设计和实现计划文档。

### 一、需求文档（requirements/）

| 文档 | 描述 | 状态 |
|------|------|------|
| [01-product-requirements.md](requirements/01-product-requirements.md) | 产品需求文档（PRD） | ✅ 完成 |
| [02-competitive-analysis.md](requirements/02-competitive-analysis.md) | 竞品分析报告 | ✅ 完成 |

**产品需求文档**包含：
- 产品定位和目标用户
- 核心功能需求（P0/P1/P2 级别）
- 用户故事和使用场景
- 非功能需求（性能、安全、兼容性）
- 里程碑规划（3 个月 MVP）
- 风险评估和成功指标

**竞品分析报告**包含：
- 5 款主流产品对比（Obsidian、Notion、印象笔记、MarkDownload、SingleFile）
- 功能对比矩阵（20+ 维度）
- 交互设计对比
- 市场机会分析
- 关键洞察和差异化策略

### 二、设计文档（design/）

| 文档 | 描述 | 状态 |
|------|------|------|
| [01-interaction-design.md](design/01-interaction-design.md) | 交互设计与 UI 规范 | ✅ 完成 |
| [02-data-structure.md](design/02-data-structure.md) | 数据结构设计 | ✅ 完成 |

**交互设计文档**包含：
- 完整的 ASCII UI 图（Popup、Modal、选择模式、历史记录、设置）
- 用户流程图（快速保存、完整编辑、历史查询）
- 交互规范（颜色、图标、动画、响应式）
- 可访问性设计（键盘导航、屏幕阅读器）
- 设计决策记录

**数据结构设计文档**包含：
- 核心数据模型（配置、历史记录、保存上下文、提取内容）
- 存储方案（browser.storage.local + IndexedDB）
- 同步数据格式（JSON/JSONL）
- 数据迁移和验证
- 数据备份与恢复
- 隐私与安全（加密、清理）

### 三、技术文档（technical/）

| 文档 | 描述 | 状态 |
|------|------|------|
| [01-technical-feasibility.md](technical/01-technical-feasibility.md) | 技术可行性分析 | ✅ 完成 |

**技术可行性文档**包含：
- 关键技术挑战识别（8 项）
- 懒加载处理方案（3 种方案对比）
- 多段选择技术实现（完整代码示例）
- 自动同步限制分析（Service Worker 生命周期）
- 保存位置选择方案（本地 + WebDAV）
- 图片批量下载（跨域处理）
- 性能评估和风险缓解
- 技术选型（核心库和架构模式）

---

## 🎯 项目概述

### 产品定位

一款**轻量级、隐私优先、支持多端同步**的网页摘录工具，帮助用户快速保存、组织和管理网页内容。

**核心价值主张**：
- 🚀 **快速**：1-2 步完成摘录（右键菜单、快捷键）
- 🎯 **灵活**：全页/多段选择，保存时决定位置
- 🔒 **隐私**：本地优先，数据自主权
- 🌐 **同步**：WebDAV 自建服务器，跨设备一致
- 🧩 **可扩展**：插件式架构，未来支持 GitHub/Notion 等

### 核心功能

**P0 级别（必须有）**：
1. ✅ 快速复制标题和 URL（Markdown 格式）
2. ✅ 全页面一键摘录（处理懒加载）
3. ✅ 局部内容摘录（单段/多段选择）
4. ✅ 保存位置灵活选择（本地/WebDAV）
5. ✅ 保存前编辑和元数据（标签、分类、备注）
6. ✅ 历史记录管理（搜索、过滤、删除）
7. ✅ WebDAV 远端保存

**P1 级别（应该有）**：
8. ✅ 图片批量下载
9. ✅ 配置同步
10. ✅ 历史记录同步和合并
11. ✅ 模板系统（4 套内置 + 自定义）

**P2 级别（可以有）**：
12. 右键菜单快捷操作
13. 键盘快捷键
14. 标签自动建议
15. 批量操作

### 竞品对比

| 功能类别 | Obsidian | Notion | 印象笔记 | MarkDownload | **我们** |
|---------|----------|--------|---------|-------------|---------|
| 易用性 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ |
| 功能性 | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| 隐私性 | ⭐⭐⭐⭐⭐ | ⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 灵活性 | ⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| **总分** | 17/20 | 15/20 | 16/20 | 11/20 | **23/25** |

**差异化优势**：
1. ✅ **唯一支持 WebDAV 的 Markdown Clipper**
2. ✅ **唯一支持多段选择的 Clipper**
3. ✅ **唯一本地 + 远端双轨的开源方案**
4. ✅ **唯一支持保存时选择位置的工具**

---

## 🔑 关键技术决策

### 1. 懒加载处理

**最终方案**：使用 `defuddle` 库（Obsidian 验证） + 可选的深度抓取模式

**原理**：
- 自动提取主要内容
- 检测到大量懒加载图片时提示用户
- 提供手动滚动触发选项

**可行性**：✅ 完全可行

### 2. 多段选择

**最终方案**：元素高亮 + 点击劫持 + 持久高亮

**原理**：
- 鼠标移动高亮可选元素
- 点击选择，Shift+点击累加
- 显示选择顺序（[1] [2] [3]）
- 完成后合并为一个 Markdown 文件

**可行性**：✅ 完全可行

### 3. 自动同步

**最终方案**：混合策略（手动 + 启动时 + 操作触发）

**限制**：
- ⚠️ Service Worker 每 5 分钟休眠
- ⚠️ chrome.alarms 最小间隔 1 分钟
- ⚠️ 定时同步不可靠

**实际策略**：
- 上传（实时）：保存内容/修改配置时立即上传
- 下载（定时）：启动时自动下载 + 可选的定时同步
- 手动（保底）：永远保留手动同步按钮

**可行性**：⚠️ 有限可行（手动 + 启动时 100% 可靠，定时同步 60% 可靠）

### 4. 技术栈

| 层级 | 技术选型 | 理由 |
|------|---------|------|
| 框架 | Vue 3 + WXT | 现代、类型安全、开发效率高 |
| 内容提取 | defuddle | Obsidian 验证，处理懒加载 |
| HTML→MD | turndown + turndown-plugin-gfm | 成熟稳定，支持 GFM |
| 浏览器兼容 | webextension-polyfill | 官方推荐 |
| 日期处理 | dayjs | 轻量，与 Obsidian 一致 |
| 图标 | lucide-vue-next | 现代，与 Obsidian 一致 |
| WebDAV | 自实现客户端 | 控制力强 |
| 存储 | browser.storage + IndexedDB | 标准 API |

---

## 📅 开发计划

### Phase 1: MVP（4 周）

**Week 1-2: 基础架构**
- 项目脚手架（WXT + Vue 3 + TypeScript）
- Content Extractor（使用 defuddle）
- Markdown Converter（使用 turndown）

**Week 3: 保存功能**
- 本地保存（browser.downloads）
- WebDAV 保存（自实现客户端）
- 保存预览 Modal

**Week 4: 历史记录**
- IndexedDB 存储
- 历史记录页面（搜索、过滤）
- 记录管理

### Phase 2: 增强功能（4 周）

**Week 5-6: 多段选择 + 懒加载**
- 多段选择 UI 和交互
- 懒加载检测和处理

**Week 7: 元数据系统**
- 标签和分类
- 模板系统（4 套内置）

**Week 8: 图片下载**
- 批量下载（Background Script）
- 后台处理和进度反馈

### Phase 3: 同步功能（4 周）

**Week 9-10: 配置同步**
- 上传/下载配置到 WebDAV
- 冲突解决

**Week 11-12: 历史同步**
- 历史记录上传/下载
- 数据合并算法
- 自动同步策略

---

## 🎨 UI 预览（ASCII）

### Popup（主入口）

```
┌─────────────────────────────────┐
│ ⚡ Web Clipper            [⚙️]  │
│ ═════════════════════════════════│
│ 📄 当前页面信息                  │
│ ┌──────────────────────────────┐│
│ │ Example Article Title       ││
│ │ 约 1,200 字 • 5 张图片 • 3分钟││
│ └──────────────────────────────┘│
│ 🚀 [📋 复制链接] [⚡ 快速保存]   │
│ 📝 摘录模式                      │
│ • 🖱️  选择区域保存              │
│ • 📑  保存整个页面              │
│ • ✨  多段选择保存              │
│ 🕐 最近保存 (3)                  │
│ • Article 1  #JavaScript  2分钟前│
│      [📚 历史记录] [⚙️ 设置]     │
└─────────────────────────────────┘
```

### 保存预览 Modal

```
┌────────────────────────────────────┐
│ Web Clipper - 保存内容       [✕]  │
│ ════════════════════════════════════│
│ 📁 [2025/01/article            .md]│
│ 🏷️  [#JavaScript] [#WebAPI] [+]   │
│ 📂 [技术文档 ▼]                    │
│ 📝 [备注...]                       │
│ ────────────────────────────────── │
│ 📄 内容预览  [Markdown ▼][预览 ☐] │
│ ┌──────────────────────────────┐  │
│ │ # Article Title              │  │
│ │ ...content...                │  │
│ └──────────────────────────────┘  │
│ ⚙️  [☑ 下载图片]                   │
│ ────────────────────────────────── │
│ 💾 [📁 本地下载] [☁️  WebDAV]      │
│        [❌ 取消]  [✅ 保存]         │
└────────────────────────────────────┘
```

---

## 🔒 隐私与安全

### 数据存储

- ✅ **本地优先**：所有数据默认存储在浏览器本地
- ✅ **可选云端**：用户决定是否启用 WebDAV 同步
- ✅ **无第三方服务器**：不上传数据到非用户指定的服务器
- ✅ **密码加密**：WebDAV 密码使用 AES-256 加密存储

### 权限最小化

**Manifest V3 权限**：
- `storage`：保存配置和历史记录
- `downloads`：本地文件下载
- `activeTab`：访问当前标签页内容
- `contextMenus`：右键菜单
- `host_permissions`：WebDAV 服务器访问

**不需要的权限**：
- ❌ `tabs`：不需要访问所有标签页
- ❌ `history`：不需要浏览器历史记录
- ❌ `cookies`：不需要 Cookie

---

## 📊 成功指标

### 功能指标

- [ ] 支持 90% 以上主流网站的内容提取
- [ ] 懒加载页面处理成功率 > 85%
- [ ] WebDAV 上传成功率 > 95%（排除网络故障）
- [ ] 历史记录同步成功率 > 99%

### 用户体验指标

- [ ] 首次使用完成配置时间 < 3 分钟
- [ ] 平均摘录时间 < 30 秒（从选择到保存完成）
- [ ] 用户满意度 > 4.0/5.0
- [ ] 留存率（30 天）> 60%

### 技术指标

- [ ] 代码测试覆盖率 > 80%
- [ ] 关键路径性能达标（见技术文档）
- [ ] 无严重安全漏洞（OWASP Top 10）
- [ ] 向后兼容性（至少 1 个大版本）

---

## 🚧 已知限制

### 技术限制

1. **自动同步**：Service Worker 生命周期限制，定时同步不可靠
2. **懒加载**：部分网站使用特殊实现，可能无法完全抓取
3. **跨域图片**：需要通过 Background Script 中转

### 功能限制

1. **依赖 WebDAV**：远端存储目前只支持 WebDAV，未来支持更多
2. **无移动端优化**：Phase 1 主要针对桌面浏览器
3. **无离线编辑**：历史记录只读，不支持二次编辑

---

## 🤝 贡献指南（未来）

### 开发环境

```bash
# 安装依赖
pnpm install

# 开发模式
pnpm dev

# 构建
pnpm build

# 测试
pnpm test
```

### 贡献类型

- 🐛 Bug 修复
- ✨ 新功能
- 📝 文档改进
- 🎨 UI/UX 优化
- 🌍 国际化翻译
- 📦 模板贡献

---

## 📄 许可证

**MIT License**（待确定）

开源、免费、允许商业使用

---

## 📞 联系方式

- GitHub Issues：（待创建）
- 讨论区：（待创建）
- 邮件：（待确定）

---

## 🎉 致谢

**参考项目**：
- [Obsidian Web Clipper](https://github.com/obsidianmd/obsidian-clipper) - 模板系统设计
- [MarkDownload](https://github.com/deathau/markdownload) - 极简主义理念
- [SingleFile](https://github.com/gildas-lormeau/SingleFile) - 懒加载处理技术

**核心库**：
- [defuddle](https://github.com/kepano/defuddle) - 内容提取
- [turndown](https://github.com/mixmark-io/turndown) - Markdown 转换
- [WXT](https://wxt.dev/) - 扩展开发框架
- [Vue 3](https://vuejs.org/) - UI 框架

---

## 📅 文档变更记录

| 日期 | 版本 | 变更内容 |
|------|------|---------|
| 2025-01-25 | v1.0 | 初始版本，完成需求分析和技术设计 |

---

**文档状态**：✅ 完成
**下一步**：开始 Phase 1 开发
**负责人**：待分配
